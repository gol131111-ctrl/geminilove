<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elektrum Admin Center</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { dark: { 900: '#050505', 800: '#0a0a0a' }, neon: { purple: '#bc13fe', cyan: '#03f4f1' } },
                    fontFamily: { cyber: ['Orbitron', 'sans-serif'], mono: ['Rajdhani', 'monospace'] }
                }
            }
        }
    </script>
    <style>
        body { background: #050505 url('bg.jpg') no-repeat center center/cover; font-family: 'Rajdhani', sans-serif; }
        body::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: -1; }
        .glass { background: rgba(18, 18, 18, 0.9); backdrop-filter: blur(12px); border: 1px solid #333; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
        .neon-input { background: #0f0f0f; border: 1px solid #333; color: white; padding: 10px; width: 100%; outline: none; transition: 0.3s; font-family: 'Rajdhani'; font-size: 16px; border-radius: 4px; }
        .neon-input:focus { border-color: #bc13fe; box-shadow: 0 0 10px rgba(188,19,254,0.2); }
        .btn { transition: all 0.3s; text-transform: uppercase; font-family: 'Orbitron'; letter-spacing: 1px; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        
        /* –°–∫—Ä–æ–ª–ª–±–∞—Ä */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #111; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #bc13fe; }
    </style>
</head>
<body class="text-white min-h-screen flex flex-col items-center justify-center p-4">

    <div id="loginOverlay" class="fixed inset-0 bg-black z-50 flex flex-col items-center justify-center">
        <h1 class="font-cyber text-5xl text-transparent bg-clip-text bg-gradient-to-r from-neon-purple to-neon-cyan mb-8 drop-shadow-[0_0_15px_#bc13fe]">ELEKTRUM ADMIN</h1>
        <div class="glass p-10 rounded-2xl w-96 flex flex-col gap-6 border border-neon-purple/30">
            <input type="password" id="passInput" placeholder="ACCESS KEY" class="neon-input text-center text-xl tracking-widest">
            <button onclick="auth()" class="btn w-full bg-neon-purple text-white py-4 rounded font-bold hover:bg-white hover:text-black">LOGIN</button>
        </div>
        <div class="mt-4 text-gray-600 text-xs font-mono">SECURE CONNECTION v2.0</div>
    </div>

    <div id="app" class="w-full max-w-[1400px] h-[90vh] hidden flex-col">
        <header class="flex justify-between items-center mb-6 glass p-6 rounded-xl border-b-2 border-neon-cyan">
            <div class="flex items-center gap-4">
                <div class="w-3 h-12 bg-neon-purple rounded-full"></div>
                <div>
                    <h2 class="font-cyber text-3xl text-white">CONTROL PANEL</h2>
                    <div class="text-neon-cyan text-xs font-mono tracking-widest">CONNECTED: GOL131111-CTRL</div>
                </div>
            </div>
            <button onclick="sync()" id="syncBtn" class="btn flex items-center gap-2 bg-dark-800 border border-neon-cyan text-neon-cyan px-6 py-3 rounded hover:bg-neon-cyan hover:text-black">
                <i data-lucide="refresh-cw"></i> SYNC DATA
            </button>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 h-full overflow-hidden">
            
            <div class="glass p-6 rounded-xl flex flex-col border-t-4 border-neon-cyan h-full overflow-hidden">
                <h3 class="font-cyber text-2xl mb-4 text-white flex items-center gap-3"><i data-lucide="package"></i> CATALOG MANAGER</h3>
                
                <div class="bg-dark-900/50 p-4 rounded-lg border border-gray-800 mb-4 shrink-0">
                    <input id="prodCat" placeholder="üìÇ –ö–ê–¢–ï–ì–û–†–ò–Ø (–ù–∞–ø—Ä–∏–º–µ—Ä: VPN, –ê–∫–∫–∞—É–Ω—Ç—ã)" class="neon-input mb-2 border-neon-cyan/50 text-neon-cyan font-bold">
                    
                    <div class="grid grid-cols-2 gap-2 mb-2">
                        <input id="prodNameRu" placeholder="üá∑üá∫ –ù–∞–∑–≤–∞–Ω–∏–µ" class="neon-input">
                        <input id="prodNameUk" placeholder="üá∫üá¶ –ù–∞–∑–≤–∞" class="neon-input">
                    </div>
                    <div class="grid grid-cols-2 gap-2 mb-2">
                        <input id="prodDescRu" placeholder="üá∑üá∫ –û–ø–∏—Å–∞–Ω–∏–µ" class="neon-input">
                        <input id="prodDescUk" placeholder="üá∫üá¶ –û–ø–∏—Å" class="neon-input">
                    </div>
                    <div class="flex gap-3">
                        <input id="prodPrice" type="number" placeholder="$$$" class="neon-input w-1/4 text-center font-bold text-xl text-green-400">
                        <button onclick="addProduct()" class="btn w-3/4 bg-neon-cyan text-black font-bold rounded">SAVE / ADD ITEM</button>
                    </div>
                </div>

                <div id="catalogList" class="space-y-2 overflow-y-auto flex-1 pr-2">
                    </div>
            </div>

            <div class="flex flex-col gap-6 h-full overflow-hidden">
                
                <div class="glass p-6 rounded-xl border-t-4 border-neon-purple flex-1 flex flex-col overflow-hidden">
                    <h3 class="font-cyber text-2xl mb-4 text-white flex items-center gap-3"><i data-lucide="users"></i> CLIENTS BASE</h3>
                    <input type="text" id="searchUser" placeholder="üîé –ü–æ–∏—Å–∫ –ø–æ @username..." class="neon-input mb-4" onkeyup="renderUsers()">
                    
                    <div class="overflow-y-auto flex-1">
                        <table class="w-full text-left text-sm">
                            <thead class="text-gray-500 border-b border-gray-700 font-mono text-xs uppercase">
                                <tr><th class="p-2">User</th><th class="p-2">Balance</th><th class="p-2">Actions</th></tr>
                            </thead>
                            <tbody id="userList"></tbody>
                        </table>
                    </div>
                </div>

                <div class="glass p-6 rounded-xl border border-gray-700 shrink-0">
                    <h3 class="font-cyber text-xl mb-4 text-gray-300 flex items-center gap-2"><i data-lucide="radio"></i> GLOBAL BROADCAST</h3>
                    
                    <div class="flex gap-2 mb-2">
                        <div class="relative w-1/3">
                            <input type="file" id="imgUpload" class="hidden" onchange="uploadImage()">
                            <label for="imgUpload" id="uploadLabel" class="btn flex items-center justify-center w-full h-full bg-gray-800 border border-gray-600 cursor-pointer hover:bg-gray-700 text-xs text-gray-300 rounded">
                                üì∑ UPLOAD PHOTO
                            </label>
                        </div>
                        <input id="bcPhoto" placeholder="–ò–ª–∏ —Å—Å—ã–ª–∫–∞ –Ω–∞ —Ñ–æ—Ç–æ..." class="neon-input w-2/3 text-xs text-gray-500">
                    </div>

                    <textarea id="bcText" rows="2" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è..." class="neon-input mb-2"></textarea>
                    
                    <div class="grid grid-cols-2 gap-2 mb-2">
                        <input id="bcBtnTxt" placeholder="–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏" class="neon-input">
                        <input id="bcBtnUrl" placeholder="–°—Å—ã–ª–∫–∞ –∫–Ω–æ–ø–∫–∏ (https://...)" class="neon-input">
                    </div>

                    <button onclick="sendBroadcast()" class="btn w-full bg-neon-purple text-white py-3 rounded font-bold tracking-widest hover:bg-white hover:text-purple-900">
                        üöÄ SEND SIGNAL
                    </button>
                </div>

            </div>
        </div>
    </div>

    <script>
        lucide.createIcons();

        // üîê –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø (–í–®–ò–¢–ê)
        const CFG = {
            pass: "Faiq2781Vuqq181ikFfsn182",
            token: "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",
            repo: "gol131111-ctrl/electrum-", // –ü–†–û–í–ï–†–¨, –ß–¢–û–ë–´ –¢–£–¢ –ë–´–õ–û –ü–†–ê–í–ò–õ–¨–ù–û
            dbFile: "db.json"
        };

        let db = { users: [], products: [] };
        let sha = "";

        // --- –í–•–û–î ---
        function auth() {
            if(document.getElementById('passInput').value === CFG.pass) {
                document.getElementById('loginOverlay').style.display = 'none';
                document.getElementById('app').classList.remove('hidden');
                document.getElementById('app').classList.add('flex');
                sync();
            } else alert("ACCESS DENIED ‚õî");
        }

        // --- GITHUB API (SYNC) ---
        async function sync() {
            const btn = document.getElementById('syncBtn');
            btn.innerHTML = '‚è≥ LOADING...';
            try {
                // nocache —á—Ç–æ–±—ã –Ω–µ –∫–µ—à–∏—Ä–æ–≤–∞–ª–æ—Å—å
                const url = `https://api.github.com/repos/${CFG.repo}/contents/${CFG.dbFile}?t=${Date.now()}`;
                const res = await fetch(url, { headers: { Authorization: `token ${CFG.token}` } });
                const data = await res.json();
                
                sha = data.sha;
                // –î–µ–∫–æ–¥–∏—Ä—É–µ–º UTF-8 –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
                const content = new TextDecoder().decode(Uint8Array.from(atob(data.content), c => c.charCodeAt(0)));
                db = JSON.parse(content);
                
                renderAll();
                btn.innerHTML = '<i data-lucide="refresh-cw"></i> SYNC DATA';
                lucide.createIcons();
            } catch(e) {
                console.error(e);
                alert("–û–®–ò–ë–ö–ê –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–ò! –ü—Ä–æ–≤–µ—Ä—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –∏–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ä–µ–ø–æ.");
                btn.innerHTML = '‚ùå ERROR';
            }
        }

        async function save(msg) {
            const contentStr = JSON.stringify(db, null, 2);
            // –ö–æ–¥–∏—Ä—É–µ–º –≤ Base64
            const contentEncoded = btoa(unescape(encodeURIComponent(contentStr)));
            
            const url = `https://api.github.com/repos/${CFG.repo}/contents/${CFG.dbFile}`;
            await fetch(url, {
                method: 'PUT',
                headers: { Authorization: `token ${CFG.token}`, 'Content-Type': 'application/json' },
                body: JSON.stringify({ message: msg, content: contentEncoded, sha: sha })
            });
            await sync(); // –û–±–Ω–æ–≤–ª—è–µ–º SHA
        }

        // --- üì∑ –ó–ê–ì–†–£–ó–ö–ê –§–û–¢–û –ù–ê GITHUB ---
        async function uploadImage() {
            const fileInput = document.getElementById('imgUpload');
            const file = fileInput.files[0];
            if(!file) return;

            const label = document.getElementById('uploadLabel');
            label.innerText = "‚è≥ UPLOADING...";

            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = async function() {
                const base64Content = reader.result.split(',')[1];
                const filename = `images/${Date.now()}_img.jpg`; // –£–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è
                
                try {
                    const res = await fetch(`https://api.github.com/repos/${CFG.repo}/contents/${filename}`, {
                        method: 'PUT',
                        headers: { Authorization: `token ${CFG.token}`, 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            message: "Upload Image",
                            content: base64Content
                        })
                    });
                    const data = await res.json();
                    
                    // –ü–æ–ª—É—á–∞–µ–º –ø—Ä—è–º—É—é —Å—Å—ã–ª–∫—É –Ω–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ
                    const imgUrl = data.content.download_url;
                    document.getElementById('bcPhoto').value = imgUrl;
                    label.innerText = "‚úÖ DONE!";
                    label.classList.add('text-green-400');
                } catch(e) {
                    alert("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ!");
                    label.innerText = "‚ùå ERROR";
                }
            };
        }

        // --- –ö–ê–¢–ê–õ–û–ì ---
        function renderCatalog() {
            const list = document.getElementById('catalogList');
            list.innerHTML = '';
            if(!db.products) db.products = [];

            db.products.forEach((p, idx) => {
                list.innerHTML += `
                    <div class="flex justify-between items-center bg-dark-900 p-3 rounded border-l-2 border-gray-700 hover:border-neon-cyan transition mb-2 group">
                        <div>
                            <div class="text-[10px] text-neon-purple uppercase font-bold tracking-wider mb-1">${p.category || 'NO CAT'}</div>
                            <div class="font-bold text-sm text-gray-200">${p.name_ru}</div>
                            <div class="text-xs text-gray-500">$${p.price}</div>
                        </div>
                        <div class="flex gap-2 opacity-50 group-hover:opacity-100 transition">
                            <button onclick="editProd(${idx})" title="Edit" class="text-blue-400 hover:text-white"><i data-lucide="edit-3" size="18"></i></button>
                            <button onclick="delProd(${idx})" title="Delete" class="text-red-500 hover:text-white"><i data-lucide="trash-2" size="18"></i></button>
                        </div>
                    </div>`;
            });
            lucide.createIcons();
        }

        function addProduct() {
            if(!document.getElementById('prodPrice').value) return alert("–¶–ï–ù–ê –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–ê!");
            
            const p = {
                id: Date.now().toString(),
                category: document.getElementById('prodCat').value,
                price: parseFloat(document.getElementById('prodPrice').value),
                name_ru: document.getElementById('prodNameRu').value,
                name_uk: document.getElementById('prodNameUk').value,
                desc_ru: document.getElementById('prodDescRu').value,
                desc_uk: document.getElementById('prodDescUk').value
            };
            db.products.push(p);
            save("Add Product");
            // –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö –ø–æ–ª–µ–π
            document.querySelectorAll('#prodNameRu, #prodNameUk, #prodDescRu, #prodDescUk, #prodPrice').forEach(i => i.value = '');
        }

        function editProd(idx) {
            const p = db.products[idx];
            document.getElementById('prodCat').value = p.category;
            document.getElementById('prodNameRu').value = p.name_ru;
            document.getElementById('prodNameUk').value = p.name_uk;
            document.getElementById('prodDescRu').value = p.desc_ru;
            document.getElementById('prodDescUk').value = p.desc_uk;
            document.getElementById('prodPrice').value = p.price;
            
            db.products.splice(idx, 1); // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π
            renderCatalog();
            alert("‚úèÔ∏è –¢–æ–≤–∞—Ä –ø–µ—Ä–µ–º–µ—â–µ–Ω –≤ —Ñ–æ—Ä–º—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è. –ò–∑–º–µ–Ω–∏ –∏ –Ω–∞–∂–º–∏ SAVE.");
        }

        function delProd(idx) {
            if(confirm("–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä?")) {
                db.products.splice(idx, 1);
                save("Del Product");
            }
        }

        // --- –Æ–ó–ï–†–´ –ò –ö–ï–®–ë–≠–ö ---
        function renderUsers() {
            const list = document.getElementById('userList');
            list.innerHTML = '';
            const q = document.getElementById('searchUser').value.toLowerCase();
            
            // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: –Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É
            const users = db.users ? db.users.slice().reverse() : [];

            users.forEach(u => {
                const realIdx = db.users.indexOf(u);
                const name = u.username ? `@${u.username}` : `ID:${u.id}`;
                
                if(name.toLowerCase().includes(q)) {
                    list.innerHTML += `
                        <tr class="border-b border-gray-800 hover:bg-white/5 transition">
                            <td class="p-2 text-neon-cyan font-mono text-sm">${name}</td>
                            <td class="p-2 font-bold">$${u.balance}</td>
                            <td class="p-2 flex gap-2">
                                <button onclick="editBal(${realIdx})" class="text-xs bg-gray-700 px-2 py-1 rounded text-gray-300 hover:text-white">EDIT</button>
                                <button onclick="sale(${realIdx})" class="text-xs bg-neon-purple text-white px-2 py-1 rounded font-bold hover:bg-white hover:text-black">SALE</button>
                            </td>
                        </tr>`;
                }
            });
        }

        function editBal(idx) {
            const val = prompt("–ù–æ–≤—ã–π –±–∞–ª–∞–Ω—Å:", db.users[idx].balance);
            if(val !== null) {
                db.users[idx].balance = parseFloat(val);
                save("Manual Balance Update");
            }
        }

        function sale(idx) {
            const amount = prompt("–°—É–º–º–∞ –ø–æ–∫—É–ø–∫–∏ –∫–ª–∏–µ–Ω—Ç–∞ ($):");
            if(!amount) return;
            
            const u = db.users[idx];
            const count = u.purchase_count || 0;
            // 10% –ø–µ—Ä–≤–∞—è, 5% –æ—Å—Ç–∞–ª—å–Ω—ã–µ
            const percent = count === 0 ? 10 : 5;
            const cashback = (parseFloat(amount) * percent) / 100;

            u.balance = (u.balance || 0) + cashback;
            u.purchase_count = count + 1;
            
            alert(`‚úÖ –ü–†–û–î–ê–ñ–ê: $${amount}\nüéÅ –ö–ï–®–ë–≠–ö (${percent}%): +$${cashback}\nüí∞ –ù–û–í–´–ô –ë–ê–õ–ê–ù–°: $${u.balance}`);
            save(`Sale $${amount}, CB $${cashback}`);
        }

        // --- –†–ê–°–°–´–õ–ö–ê ---
        function sendBroadcast() {
            const txt = document.getElementById('bcText').value;
            if(!txt) return alert("–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç!");
            
            if(confirm("‚ö†Ô∏è –û–¢–ü–†–ê–í–ò–¢–¨ –í–°–ï–ú?")) {
                db.broadcast = {
                    text: txt,
                    photo: document.getElementById('bcPhoto').value,
                    btn_text: document.getElementById('bcBtnTxt').value,
                    btn_url: document.getElementById('bcBtnUrl').value
                };
                save("Broadcast Triggered");
                alert("üöÄ –°–∏–≥–Ω–∞–ª –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω! –ë–æ—Ç –Ω–∞—á–Ω–µ—Ç —Ä–∞–±–æ—Ç—É.");
                document.getElementById('bcText').value = '';
                document.getElementById('bcPhoto').value = '';
            }
        }

        function renderAll() {
            renderCatalog();
            renderUsers();
        }
    </script>
</body>
</html>
